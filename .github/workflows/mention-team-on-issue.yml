name: Mention Team on Issue Creation

on:
  issues:
    types: [opened]

jobs:
  mention-team:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install yq
        run: |
          sudo apt-get update
          sudo apt-get install -y yq

      - name: Comment with team mention
        env:
          ISSUE_CREATOR: ${{ github.actor }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          REPO: ${{ github.repository }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ORG_NAME: bangguseok-lab
        run: |
          TEAM=$(yq ".\"$ISSUE_CREATOR\"" user-team-map.yml)

          if [ "$TEAM" = "null" ] || [ -z "$TEAM" ]; then
            echo "âŒ íŒ€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            exit 0
          fi

          echo "ðŸ”” @${ORG_NAME}/${TEAM} íŒ€\nì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤ ðŸ™Œ\n\nìž‘ì„±ìž: @$ISSUE_CREATOR" > comment.md

          echo "$GITHUB_TOKEN" | gh auth login --with-token

          gh api repos/$REPO/issues/$ISSUE_NUMBER/comments \
            --method POST \
            --field body="$(cat comment.md)"
